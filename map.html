<!DOCTYPE html>

<html>
<head>
<title> The Marauder's Maaeeepp </title>

<meta charset="utf-8">
<link rel="stylesheet" href="style.css" type="text/css" />
<script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?sensor=true">
      </script>

<script>
// geolocation


var crd;
var myLatLng = new google.maps.LatLng(42,-72);
var object;
function success(pos) {
   crd = pos.coords;

  console.log('Your current position is:');
  console.log('Latitude : ' + crd.latitude);
  console.log('Longitude: ' + crd.longitude);
  console.log('More or less ' + crd.accuracy + ' meters.');
};
navigator.geolocation.getCurrentPosition(success);


function initialize(pos) {
		crd = pos.coords;
        var mapOptions = {
          center: { lat: crd.latitude, lng: crd.longitude},
          zoom: 18
        };
        map = new google.maps.Map(document.getElementById('map-canvas'),
            mapOptions);
        fillmap();

      }
      navigator.geolocation.getCurrentPosition(initialize);
      google.maps.event.addDomListener(window, 'load', initialize);
      

function createCoords(lat, lng){
	urLatLng = new google.maps.LatLng(lat, lng);
	return urLatLng;
}


function fillmap() {
	xhr = new XMLHttpRequest();
	requestInfo = "login=SnowWhite&lat=3&lng=4";
	xhr.open('POST', 'http://chickenofthesea.herokuapp.com/sendLocation', true);
	xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
	
	xhr.send(requestInfo);
	xhr.onreadystatechange = function() {
	if(xhr.readyState == 4 && xhr.status == 200) {
	        alert("hey your readystatechangeworked");
			console.log("probs got data back");
		object = JSON.parse(xhr.responseText);
		console.log("about ot call");
	makeMarkers();
		}
	
	}
	
}

function makeMarkers(){
	var myLatLng = new google.maps.LatLng(42,-72);
	myStuds = object.students;
	console.log("ay girl");
	for (i=0; i< myStuds.length; i++)
	{
		marker = new google.maps.Marker({
	    position: createCoords(myStuds[i]["lat"], myStuds[i]["lng"]),
	    map: map,
	    title:"Hello World!"});
	    console.log("ay girl");
	    marker.setMap(map);
	}

}
</script>



</head>

<body>
	<h1> the mordor's maep </h1>
	<div id="map-canvas"></div>
	

</body>


</html>